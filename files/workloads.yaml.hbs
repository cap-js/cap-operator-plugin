workloads:
    server:
        name: server
        labels:
            sme.sap.com/app-type: {{appName}}
        consumedBTPServices:
        {{#hasXsuaa}}
        - {{appName}}-uaa-bind
        {{#isApp}}
        - {{appName}}-saas-registry-bind
        {{/isApp}}
        {{/hasXsuaa}}
        {{#hasIas}}
        - {{appName}}-identity-bind
        {{#isApp}}
        - {{appName}}-subscription-manager-bind
        {{/isApp}}
        {{/hasIas}}
        {{#isApp}}
        - {{appName}}-service-manager-bind
        {{/isApp}}
        deploymentDefinition:
            {{#isApp}}
            type: CAP
            {{/isApp}}
            {{#isService}}
            type: Service
            ports:
            - name: server-port
              port: 4004
              appProtocol: http
            {{/isService}}
            image:
            {{#hasAms}}
            env:
            - name: AMS_DCL_ROOT
              value: ams/dcl
            securityContext:
                runAsUser: 1000
                runAsGroup: 1000
            {{/hasAms}}

    contentDeploy:
        name: content-deploy
        labels:
            sme.sap.com/app-type: {{appName}}
        consumedBTPServices:
        {{#hasXsuaa}}
        - {{appName}}-uaa-bind
        {{/hasXsuaa}}
        {{#hasIas}}
        - {{appName}}-identity-bind
        {{/hasIas}}
        {{#hasHtml5Repo}}
        - {{appName}}-html5-repo-host-bind
        {{/hasHtml5Repo}}
        jobDefinition:
            type: Content
            image:

    {{#isApp}}
    tenantJob:
        name: tenant-job
        labels:
            sme.sap.com/app-type: {{appName}}
        consumedBTPServices:
        {{#hasXsuaa}}
        - {{appName}}-uaa-bind
        - {{appName}}-saas-registry-bind
        {{/hasXsuaa}}
        {{#hasIas}}
        - {{appName}}-identity-bind
        - {{appName}}-subscription-manager-bind
        {{/hasIas}}
        - {{appName}}-service-manager-bind
        jobDefinition:
            type: TenantOperation
            image:
    {{/isApp}}

    {{#hasAms}}
    amsDeployer:
        name: ams-deployer
        labels:
            sme.sap.com/app-type: {{appName}}
        consumedBTPServices:
        {{#hasIas}}
        - {{appName}}-identity-bind
        {{/hasIas}}
        jobDefinition:
            type: Content
            image:
    {{/hasAms}}

{{#isService}}
serviceExposures:
- subDomain: {{appName}}
  routes:
  - workloadName: server
    port: 4004
{{/isService}}

{{#hasAms}}
contentJobs:
- content-deploy
- ams-deployer
{{/hasAms}}
